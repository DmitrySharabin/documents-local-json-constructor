<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="author" content="Dmitry Sharabin">

	<link rel="stylesheet" href="./style.css">

	<!-- Mavo -->
	<link rel="stylesheet" href="./mavo/mavo.min.css">
	<script src="./mavo/mavo.es5.min.js"></script>

	<title>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</title>
</head>

<body>
	<main mv-app="documents.local" mv-bar="with import export" mv-plugins="locale-ru" mv-mode="edit">
		<h1>
			üìë –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
		</h1>
		<article mv-multiple="document" class="[if(type = 'form', 'word', 'pdf')]">
			<meta property="type" content="form" mv-mode="read">

			<h2>
				<span property="id">[$index + 1]</span>
				<div>
					<img mv-action="set(type, 'form')" src="./assets/MS-Word-logo.svg" height="80"
						alt="–õ–æ–≥–æ—Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ Microsoft Word" class="[if(type = 'example', 'disabled')]">
					<img mv-action="set(type, 'example')" src="./assets/PDF-logo.svg" height="80" alt="–õ–æ–≥–æ—Ç–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ PDF"
						class="[if(type = 'form', 'disabled')]">
					<meta property="template" datatype="boolean" mv-mode="read">
					<div hidden="[type = 'example']" class="answer">
						<span>–ù—É–∂–Ω–æ –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ?</span>
						<b mv-action="set(template, true)" class="[if(template, 'chosen')]">–î–∞</b>
						<b mv-action="set(template, false)" class="[if(!template, 'chosen')]">–ù–µ—Ç</b>
					</div>
					<div hidden="[type = 'form']" class="answer">
						<table>
							<thead>
								<tr>
									<th>–°—Ç—Ä–∞–Ω–∏—Ü</th>
									<th>–°–∫—Ä–∏–Ω—à–æ—Ç–æ–≤</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td><input property="__total_pages" type="number" min="1" value="1"></td>
									<td><input property="__image_count" type="number" min="1" value="1"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<p>
					<span property="path" aria-label="–ò–º—è —Ñ–∞–π–ª–∞" class="[if(type = 'form', 'word', 'pdf')]"></span>
				</p>
			</h2>

			<h3 property="name" aria-label="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Äî –¥–ª—è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤" mv-default="[path]"></h3>

			<details open>
				<summary>–í—ã–±–æ—Ä—ã</summary>
				<p mv-multiple="election_types" mv-editor="#elections" mv-default="5" mv-initial-items="0">
				</p>
				<button class="mv-add-election_types">–î–æ–±–∞–≤–∏—Ç—å</button>
			</details>

			<details open>
				<summary>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</summary>
				<p mv-multiple="categories" mv-editor="#categories" mv-default="19" mv-initial-items="0">
				</p>
				<button class="mv-add-categories">–î–æ–±–∞–≤–∏—Ç—å</button>
			</details>
		</article>

		<button class="mv-ui mv-add-document">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
	</main>

	<!-- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ ¬´–¢–∏–ø—ã –≤—ã–±–æ—Ä–æ–≤¬ª -->
	<div hidden mv-app="electionTypes" mv-source="./json/election_types.json">
		<select id="elections">
			<option mv-multiple value="[id]" mv-group>[name]</option>
		</select>
	</div>

	<!-- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ ¬´–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤¬ª -->
	<div hidden mv-app="documentCategories" mv-source="./json/document_categories.json">
		<select id="categories">
			<option mv-multiple value="[id]" mv-group>[name]</option>
		</select>
	</div>

	<!-- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞ –∏/–∏–ª–∏ –ø–µ—Ä–µ–¥ –∏—Ö –≤—ã–≥—Ä—É–∑–∫–æ–π –≤ —Ñ–∞–π–ª -->
	<script>
		(async function () {
			const appName = "documents.local";

			Mavo.hooks.add("render-start", function (env) {
				if (this.id !== appName) {
					return;
				}

				const documents = env.data;
				env.data.document = [];

				for (const document of documents) {
					const file = document.files[0];
					document.template = file.template;

					// –£–¥–∞–ª—è–µ–º ¬´path/¬ª –≤ –Ω–∞—á–∞–ª–µ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (—Å —Ç–æ—á–∫–æ–π) –≤ –∫–æ–Ω—Ü–µ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É.
					document.path = file.path.slice(5, -4);

					delete document.files;

					env.data.document.push(document);
				}
			});

			Mavo.hooks.add("getdata-end", function (env) {
				if (this.id !== appName) {
					return;
				}

				const documents = env.data.document;
				env.data = [];

				for (const document of documents) {
					document.description = "";
					document.keywords = [];
					document.files = [{
						id: 1,
						path: `path/${document.path}.${document.type === "form" ? "doc" : "pdf"}`,
						template: document.type === "form" ? document.template : false,
						rules: [{
							then: "accept"
						}]
					}];

					if (document.type === "form") {
						delete document["__image_count"];
						delete document["__total_pages"];
					}

					delete document.path;
					delete document.template;

					env.data.push(document);
				}
			});
		})();
	</script>
</body>

</html>
